import{Q as L}from"./QBtn-ByGc03q8.js";import{Q as re}from"./QPage-CgtHVJDB.js";import{Q as ie}from"./QIcon-Cc8OfBfg.js";import{Q as oe}from"./QChip-BA5Eck6V.js";import{u as ue,a as se,b as ce,f as J,c as de,d as W,e as fe}from"./use-key-composition-B_kTy54J.js";import{u as me,a as pe}from"./private.use-form-BPkJXAbm.js";import{g as H,r as D,a as x,K as ve,L as E,M as ge,h as k,c as te,N as he,O as ye,G as O,v as R,B as _,z as U,P as be,Q as xe,o as Fe,d as _e,p as Se,R as Ce,E as X,u as A,C as M,F as Z,D as Ve,H as Pe,I as ke,J as Re,S as ee}from"./index-57RAIp0g.js";import{u as Te,Q as qe}from"./QInput-LfgKR6-w.js";import{h as ze}from"./format-CJebrXOQ.js";import{h as Ie}from"./render-CWgEJjHR.js";import{v as Ue}from"./vm-joK3a_I0.js";import{Q as K,a as De}from"./QCard-DyyPli0X.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QSpinner-bSmicc2C.js";import"./use-dark-DsmObZw5.js";function $(e,r,f,p){const a=[];return e.forEach(n=>{p(n)===!0?a.push(n):r.push({failedPropValidation:f,file:n})}),a}function Q(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),E(e)}const $e={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},je=["rejected"];function Qe({editable:e,dnd:r,getFileInput:f,addFilesToQueue:p}){const{props:a,emit:n,proxy:i}=H(),m=D(null),C=x(()=>a.accept!==void 0?a.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),T=x(()=>parseInt(a.maxFiles,10)),q=x(()=>parseInt(a.maxTotalSize,10));function V(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&ve(t);else{const u=f();u&&u!==t.target&&u.click(t)}}function z(t){e.value&&t&&p(null,t)}function s(t,u,v,h){let o=Array.from(u||t.target.files);const y=[],P=()=>{y.length!==0&&n("rejected",y)};if(a.accept!==void 0&&C.value.indexOf("*/")===-1&&(o=$(o,y,"accept",d=>C.value.some(g=>d.type.toUpperCase().startsWith(g)||d.name.toUpperCase().endsWith(g))),o.length===0))return P();if(a.maxFileSize!==void 0){const d=parseInt(a.maxFileSize,10);if(o=$(o,y,"max-file-size",g=>g.size<=d),o.length===0)return P()}if(a.multiple!==!0&&o.length!==0&&(o=[o[0]]),o.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),h===!0){const d=v.map(g=>g.__key);o=$(o,y,"duplicate",g=>d.includes(g.__key)===!1)}if(o.length===0)return P();if(a.maxTotalSize!==void 0){let d=h===!0?v.reduce((g,B)=>g+B.size,0):0;if(o=$(o,y,"max-total-size",g=>(d+=g.size,d<=q.value)),o.length===0)return P()}if(typeof a.filter=="function"){const d=a.filter(o);o=$(o,y,"filter",g=>d.includes(g))}if(a.maxFiles!==void 0){let d=h===!0?v.length:0;if(o=$(o,y,"max-files",()=>(d++,d<=T.value)),o.length===0)return P()}if(P(),o.length!==0)return o}function F(t){Q(t),r.value!==!0&&(r.value=!0)}function c(t){E(t),(t.relatedTarget!==null||ge.is.safari!==!0?t.relatedTarget!==m.value:document.elementsFromPoint(t.clientX,t.clientY).includes(m.value)===!1)===!0&&(r.value=!1)}function I(t){Q(t);const u=t.dataTransfer.files;u.length!==0&&p(null,u),r.value=!1}function N(t){if(r.value===!0)return k("div",{ref:m,class:`q-${t}__dnd absolute-full`,onDragenter:Q,onDragover:Q,onDragleave:c,onDrop:I})}return Object.assign(i,{pickFiles:V,addFiles:z}),{pickFiles:V,addFiles:z,onDragover:F,onDragleave:c,processFiles:s,getDndNode:N,maxFilesNumber:T,maxTotalSizeNumber:q}}const Ae=te({name:"QFile",inheritAttrs:!1,props:{...se,...me,...$e,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ue,...je],setup(e,{slots:r,emit:f,attrs:p}){const{proxy:a}=H(),n=ce(),i=D(null),m=D(!1),C=pe(e),{pickFiles:T,onDragover:q,onDragleave:V,processFiles:z,getDndNode:s}=Qe({editable:n.editable,dnd:m,getFileInput:Y,addFilesToQueue:G}),F=Te(e),c=x(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),I=x(()=>J(c.value)),N=x(()=>c.value.map(l=>l.name).join(", ")),t=x(()=>ze(c.value.reduce((l,b)=>l+b.size,0))),u=x(()=>({totalSize:t.value,filesNumber:c.value.length,maxFiles:e.maxFiles})),v=x(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:C.value,...p,id:n.targetUid.value,disabled:n.editable.value!==!0})),h=x(()=>"q-file q-field--auto-height"+(m.value===!0?" q-file--dnd":"")),o=x(()=>e.multiple===!0&&e.append===!0);function y(l){const b=c.value.slice();b.splice(l,1),d(b)}function P(l){const b=c.value.indexOf(l);b!==-1&&y(b)}function d(l){f("update:modelValue",e.multiple===!0?l:l[0])}function g(l){l.keyCode===13&&ye(l)}function B(l){(l.keyCode===13||l.keyCode===32)&&T(l)}function Y(){return i.value}function G(l,b){const S=z(l,b,c.value,o.value),w=Y();w!=null&&(w.value=""),S!==void 0&&((e.multiple===!0?e.modelValue&&S.every(le=>c.value.includes(le)):e.modelValue===S[0])||d(o.value===!0?c.value.concat(S):S))}function j(){return[k("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ne(){if(r.file!==void 0)return c.value.length===0?j():c.value.map((b,S)=>r.file({index:S,file:b,ref:this}));if(r.selected!==void 0)return c.value.length===0?j():r.selected({files:c.value,ref:this});if(e.useChips===!0)return c.value.length===0?j():c.value.map((b,S)=>k(oe,{key:"file-"+S,removable:n.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{y(S)}},()=>k("span",{class:"ellipsis",textContent:b.name})));const l=e.displayValue!==void 0?e.displayValue:N.value;return l.length!==0?[k("div",{class:e.inputClass,style:e.inputStyle,textContent:l})]:j()}function ae(){const l={ref:i,...v.value,...F.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:G};return e.multiple===!0&&(l.multiple=!0),k("input",l)}return Object.assign(n,{fieldClass:h,emitValue:d,hasValue:I,inputRef:i,innerValue:c,floatingLabel:x(()=>I.value===!0||J(e.displayValue)),computedCounter:x(()=>{if(e.counterLabel!==void 0)return e.counterLabel(u.value);const l=e.maxFiles;return`${c.value.length}${l!==void 0?" / "+l:""} (${t.value})`}),getControlChild:()=>s("file"),getControl:()=>{const l={ref:n.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return n.editable.value===!0&&Object.assign(l,{onDragover:q,onDragleave:V,onKeydown:g,onKeyup:B}),k("div",l,[ae()].concat(ne()))}}),Object.assign(a,{removeAtIndex:y,removeFile:P,getNativeElement:()=>i.value}),he(a,"nativeEl",()=>i.value),de(n)}}),Le={class:"q-pa-md"},Ee={__name:"FileUploader",setup(e){const r=D(null),f=D(""),p=W(),a=async n=>{if(n)try{const i=URL.createObjectURL(n),C=await(await fetch(i)).text();f.value=C,p.$patch({csv:f.value}),console.log("File text in store",p.csv),URL.revokeObjectURL(i)}catch(i){console.error("File could not be fetched!",i)}};return(n,i)=>(R(),O("div",Le,[_(Ae,{accept:".csv",modelValue:r.value,"onUpdate:modelValue":[i[0]||(i[0]=m=>r.value=m),a],label:"Pick one file",filled:"",style:{"max-width":"300px"},clearable:""},{prepend:U(()=>[_(ie,{name:"attach_file"})]),_:1},8,["modelValue"])]))}},Oe=te({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:r,emit:f}){const p=H(),a=D(null);let n=0;const i=[];function m(s){const F=typeof s=="boolean"?s:e.noErrorFocus!==!0,c=++n,I=(u,v)=>{f(`validation${u===!0?"Success":"Error"}`,v)},N=u=>{const v=u.validate();return typeof v.then=="function"?v.then(h=>({valid:h,comp:u}),h=>({valid:!1,comp:u,err:h})):Promise.resolve({valid:v,comp:u})};return(e.greedy===!0?Promise.all(i.map(N)).then(u=>u.filter(v=>v.valid!==!0)):i.reduce((u,v)=>u.then(()=>N(v).then(h=>{if(h.valid===!1)return Promise.reject(h)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return c===n&&I(!0),!0;if(c===n){const{comp:v,err:h}=u[0];if(h!==void 0&&console.error(h),I(!1,v),F===!0){const o=u.find(({comp:y})=>typeof y.focus=="function"&&Ue(y.$)===!1);o!==void 0&&o.comp.focus()}}return!1})}function C(){n++,i.forEach(s=>{typeof s.resetValidation=="function"&&s.resetValidation()})}function T(s){s!==void 0&&E(s);const F=n+1;m().then(c=>{F===n&&c===!0&&(e.onSubmit!==void 0?f("submit",s):s!==void 0&&s.target!==void 0&&typeof s.target.submit=="function"&&s.target.submit())})}function q(s){s!==void 0&&E(s),f("reset"),_e(()=>{C(),e.autofocus===!0&&e.noResetFocus!==!0&&V()})}function V(){fe(()=>{if(a.value===null)return;const s=a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),F=>F.tabIndex!==-1);s?.focus({preventScroll:!0})})}Se(Ce,{bindComponent(s){i.push(s)},unbindComponent(s){const F=i.indexOf(s);F!==-1&&i.splice(F,1)}});let z=!1;return be(()=>{z=!0}),xe(()=>{z===!0&&e.autofocus===!0&&V()}),Fe(()=>{e.autofocus===!0&&V()}),Object.assign(p.proxy,{validate:m,resetValidation:C,submit:T,reset:q,focus:V,getValidationComponents:()=>i}),()=>k("form",{class:"q-form",ref:a,onSubmit:T,onReset:q},Ie(r.default))}}),Be={class:"q-pa-md",style:{"max-width":"400px"}},we={__name:"FileFetcher",setup(e){const r=W(),f=D("");function p(){f.value=null,r.setFile(f.value)}async function a(){console.log("fetching URL: ",f.value);try{const n=await fetch(f.value,{headers:{"content-type":"text/csv;charset=UTF-8"}});if(await n.url.startsWith("http://localhost:9000/")){alert("File could not be fetched. Please check the URL and try again.");return}const i=await n.text();r.$patch({csv:i}),console.log("File text in store: ",r.csv)}catch(n){console.error(n),alert("File could not be fetched. Please check the URL and try again.")}}return(n,i)=>(R(),O("div",Be,[_(Oe,{onSubmit:i[1]||(i[1]=m=>a()),onReset:p,class:"q-gutter-md"},{default:U(()=>[_(qe,{filled:"",modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=m=>f.value=m),label:"Filepath",hint:"URL of the file","lazy-rules":"",rules:[m=>m&&m.length>0||"Please select a valid URL"]},null,8,["modelValue","rules"]),X("div",null,[_(L,{label:"Submit",type:"submit",color:"primary"}),_(L,{label:"Reset",type:"reset",color:"primary",flat:"",class:"q-ml-sm"})])]),_:1})]))}},Ke=["src"],Me={class:"text-h6"},We={__name:"UploadDataCard",props:{cardTitle:{type:String,required:!0},cardText:{type:String,required:!0},cardImage:{type:String,default:""},component:{type:Object,default:null}},setup(e){const r=e;return(f,p)=>(R(),A(De,null,{default:U(()=>[r.cardImage?(R(),O("img",{key:0,src:r.cardImage},null,8,Ke)):M("",!0),_(K,null,{default:U(()=>[X("div",Me,Z(r.cardTitle),1)]),_:1}),_(K,{class:"q-pt-none"},{default:U(()=>[Ve(Z(r.cardText),1)]),_:1}),_(K,null,{default:U(()=>[_(r.component)]),_:1})]),_:1}))}},He=Ne(We,[["__scopeId","data-v-89ae2db0"]]),Xe={class:"q-pa-md row items-start q-gutter-md"},dt={__name:"vocabularyPage",setup(e){const r=W(),f=[{cardTitle:"upload file",cardText:"upload local csv file",component:Ee},{cardTitle:"upload path",cardText:"name path to csv file",component:we}];return(p,a)=>(R(),A(re,{class:"flex flex-center"},{default:U(()=>[X("div",Xe,[(R(),O(Pe,null,ke(f,n=>_(He,Re({key:n.title,ref_for:!0},n),null,16)),64))]),ee(r).csv?(R(),A(L,{key:0,label:"Load Table",color:"primary",onClick:a[0]||(a[0]=n=>p.$router.push("/voc/table"))})):M("",!0),ee(r).hierarchy?(R(),A(L,{key:1,label:"Load Hierarchy",color:"primary",onClick:a[1]||(a[1]=n=>p.$router.push("/voc/hierarchy"))})):M("",!0)]),_:1}))}};export{dt as default};
